<!DOCTYPE html>  <html> <head>   <title>base.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="base.html">                 base.js               </a>                                           <a class="source" href="directory.html">                 directory.js               </a>                                           <a class="source" href="file.html">                 file.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               base.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="nx">define</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h1>Finding and creating models</h1>

<p>We might need to get access to a model from anywhere and we want
to make sure that we don't end up with multiple models all pointing
to the same resource on the server. The methods here let you create
and find all the models that are currently loaded so that we never
accidentally duplicate something. E.g.</p>

<pre><code>var Train = Base.extend();
var thomas = Train.findOrBuild("thomas");
thomas == Train.findOrBuild("thomas"); // true
thomas == new Train({ "id" : "thomas" }); // false
</code></pre>

<p>Models are indexed by their <code>idAttribute</code> as specified by
Backbone. By default this is <code>id</code>, but whatever it is set to it 
should uniquely identify the server resource that the model corresponds to.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">Base</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>When trying to get a reference to a model, you should use <code>findOrBuild</code>.
This takes one argument which is the model's <code>id</code> and will either return the
existing model with that <code>id</code> or create it if it doesn't exist.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">findOrBuild</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">model</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">model</span><span class="p">)</span> <span class="k">return</span> <span class="nx">model</span><span class="p">;</span>

      <span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{};</span>
      <span class="nx">options</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">idAttribute</span><span class="p">]</span> <span class="o">=</span> <span class="nx">id</span><span class="p">;</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">build</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p><code>build</code> is a wrapper for the usual <code>new Model()</code>. It instantiates the model
but then saves it in the index of loaded models.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">build</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">model</span> <span class="o">=</span> <span class="k">new</span> <span class="k">this</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">loadedModels</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">loadedModels</span> <span class="o">||</span> <span class="p">{};</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">loadedModels</span><span class="p">[</span><span class="nx">model</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">model</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>It's possible for a model's id to change. If it does we update our index.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
      <span class="nx">model</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;change:&quot;</span> <span class="o">+</span> <span class="nx">model</span><span class="p">.</span><span class="nx">idAttribute</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">loadedModels</span><span class="p">[</span><span class="nx">model</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">loadedModels</span><span class="p">[</span><span class="nx">model</span><span class="p">.</span><span class="nx">previous</span><span class="p">(</span><span class="nx">model</span><span class="p">.</span><span class="nx">idAttribute</span><span class="p">)]</span>
        <span class="k">delete</span> <span class="nx">self</span><span class="p">.</span><span class="nx">loadedModels</span><span class="p">[</span><span class="nx">model</span><span class="p">.</span><span class="nx">previous</span><span class="p">(</span><span class="nx">model</span><span class="p">.</span><span class="nx">idAttribute</span><span class="p">)];</span>
      <span class="p">})</span>

      <span class="k">return</span> <span class="nx">model</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p><code>find</code> looks up a model in the index and returns it if it's present.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">find</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">loadedModels</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">loadedModels</span> <span class="o">||</span> <span class="p">{};</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">loadedModels</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="k">return</span> <span class="nx">Base</span><span class="p">;</span>
<span class="p">});</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 